<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - DocQuery.ai</title>
  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap"
    rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <!-- CSS -->
  {% load static %}
  <link rel="stylesheet" href="{% static 'ragapp/style.css' %}?v=36">
  <link rel="stylesheet" href="{% static 'ragapp/dashboard_theme.css' %}?v=15">
  <style>
    /* Hide scrollbar for Documents Grid but allow scrolling */
    .docs-grid::-webkit-scrollbar {
      display: none;
    }

    .docs-grid {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
    }

    /* Hide GLOBAL scrollbar for the entire page */
    ::-webkit-scrollbar {
      display: none;
    }

    html,
    body {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
      cursor: auto !important;
    }

    /* Disable custom cursor */
    * {
      cursor: auto !important;
    }

    /* Pointer cursor for clickable elements */
    a,
    button,
    [role="button"],
    .clickable,
    input[type="submit"],
    input[type="button"],
    select,
    [onclick],
    .doc-card,
    .action-btn,
    .feature-card,
    .nav-link,
    .user-avatar,
    .user-avatar *,
    #themeToggle,
    #themeToggle * {
      cursor: pointer !important;
    }
  </style>
</head>

<body data-theme="light"> <!-- Default Light Theme -->

  <!-- Navigation -->
  {% include "ragapp/components/navbar.html" %}

  <!-- Hero Section -->
  <section class="hero-section" style="padding: 40px 0;"> <!-- Compact Padding -->
    <div class="hero-content" style="gap: 16px; margin-bottom: 24px;"> <!-- Tighter Gap -->
      <h1 class="hero-title" style="font-size: 2.5rem; letter-spacing: -0.02em;">
        AI-Powered Knowledge Retrieval from Documents
      </h1>
      <p style="font-size: 1.1rem; color: var(--text-secondary); max-width: 600px; margin: 0 auto; line-height: 1.5;">
        Advanced RAG system with semantic search, context-aware retrieval, and intelligent document understanding.
      </p>
    </div>

    <!-- Search Bar with Integrated Upload & Embedded Mic -->
    <div class="hero-search-wrapper" id="searchWrapper" style="max-width: 680px; margin: 0 auto;">
      <div class="search-inner" style="position: relative; display: flex; align-items: center;">

        <!-- Attach Button (Left) -->
        <button class="attach-btn" id="attachBtn" title="Upload Document" style="left: 10px;">
          <i class="fas fa-paperclip"></i>
        </button>

        <!-- Search Input -->
        <input type="text" class="hero-search-input" placeholder="Ask a question about your documents..."
          id="heroSearchInput" style="padding-right: 64px; /* Space for Mic */">

        <!-- Mic Button (Uniquely Embedded Right) -->
        <button class="dashboard-mic-btn" id="heroMicBtn"
          style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 48px; height: 48px; border-radius: 50%; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
          <i class="fas fa-microphone" style="font-size: 1.1rem;"></i>
        </button>

        <!-- Hover Effect for Mic (Inline for simplicity or use CSS class) -->
        <style>
          .dashboard-mic-btn:hover {
            background-color: var(--bg-surface-hover) !important;
            color: var(--accent-primary) !important;
          }
        </style>

        <!-- Submit Button (Hidden initially, replaces mic logic in JS if active) -->
        <button class="search-submit-btn" id="heroSearchSubmit"
          style="display: none; right: 8px; width: 48px; height: 48px; font-size: 1.1rem;">
          <i class="fas fa-arrow-right"></i>
        </button>

        <!-- Hidden File Input -->
        <input type="file" id="searchFileInput" multiple accept=".pdf" style="display: none;">
      </div>

      <!-- Upload Progress Indicator -->
      <div id="uploadProgress" class="upload-progress-container" style="display: none; margin-top: 12px;">
        <div class="upload-spinner"></div>
        <span id="uploadStatusText">Processing document...</span>
      </div>
    </div>
  </section>

  <!-- My Documents -->
  <section class="section-container">
    <div class="section-header">
      <h2>My Documents</h2>
    </div>

    <div class="docs-grid" id="pdfGrid">
      <!-- JS will populate this -->
      <div class="pdf-loading" style="grid-column: 1 / -1;">
        <div class="spinner"></div>
        <span>Loading documents...</span>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="section-container"
    style="background: var(--bg-surface-hover); border-radius: 24px; margin-bottom: 60px; padding: 50px 5%;">
    <div class="section-header" style="text-align: center; margin-bottom: 48px;">
      <h2 style="margin-bottom: 12px;">Powerful Features</h2>
      <p style="color: var(--text-secondary); font-size: 1.05rem; max-width: 600px; margin: 0 auto;">Everything you need
        to unlock insights from your documents with AI-powered intelligence.</p>
    </div>

    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-search"></i>
        </div>
        <h4>Semantic Search</h4>
        <p class="feature-desc">Find answers instantly using meaning, not keywords.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-robot"></i>
        </div>
        <h4>AI Q&A</h4>
        <p class="feature-desc">Ask questions and get precise answers from your documents.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        <h4>Smart Summary</h4>
        <p class="feature-desc">Generate concise summaries of long documents instantly.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-lightbulb"></i>
        </div>
        <h4>Key Insights</h4>
        <p class="feature-desc">Extract important keywords, topics, and critical information.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-file-signature"></i>
        </div>
        <h4>PDF Annotator</h4>
        <p class="feature-desc">Highlight, comment, and save insights directly on PDFs.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-bookmark"></i>
        </div>
        <h4>Favorites</h4>
        <p class="feature-desc">Save and organize your most important answers and insights.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-history"></i>
        </div>
        <h4>Search History</h4>
        <p class="feature-desc">Track your queries and revisit past conversations anytime.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-file-export"></i>
        </div>
        <h4>Export Data</h4>
        <p class="feature-desc">Download your chats and insights in multiple formats.</p>
      </div>
    </div>
  </section>

  <!-- Floating Upload Button Removed -->

  <!-- Footer -->
  <footer class="main-footer">
    <div class="footer-grid">
      <div class="footer-col" style="flex:2">
        <div style="margin-bottom:15px; font-size:22px; font-weight:700; color: var(--text-primary);">
          <i class="fas fa-cube"></i> DocQuery.ai
        </div>
        <p style="max-width:300px; font-size:14px; line-height:1.6; color: var(--text-secondary);">
          Turning documents into knowledge. The most advanced RAG platform for technical teams.
        </p>
        <div style="display:flex; gap:12px; margin-top:16px;">
          <a href="https://github.com/gopalmuri" target="_blank"
            style="width:36px; height:36px; border-radius:50%; background:var(--bg-surface-hover); color:var(--text-secondary); display:flex; align-items:center; justify-content:center; text-decoration:none; transition:all 0.2s;">
            <i class="fab fa-github"></i>
          </a>
          <a href="https://linkedin.com/in/gopalmuri" target="_blank"
            style="width:36px; height:36px; border-radius:50%; background:var(--bg-surface-hover); color:var(--text-secondary); display:flex; align-items:center; justify-content:center; text-decoration:none; transition:all 0.2s;">
            <i class="fab fa-linkedin-in"></i>
          </a>
          <a href="https://instagram.com/gopalmuri" target="_blank"
            style="width:36px; height:36px; border-radius:50%; background:var(--bg-surface-hover); color:var(--text-secondary); display:flex; align-items:center; justify-content:center; text-decoration:none; transition:all 0.2s;">
            <i class="fab fa-instagram"></i>
          </a>
          <a href="mailto:gopalmuri1919@gmail.com"
            style="width:36px; height:36px; border-radius:50%; background:var(--bg-surface-hover); color:var(--text-secondary); display:flex; align-items:center; justify-content:center; text-decoration:none; transition:all 0.2s;">
            <i class="fas fa-envelope"></i>
          </a>
        </div>
      </div>
      <div class="footer-col">
        <h4 style="margin-bottom:16px;">Product</h4>
        <div style="display:flex; flex-direction:column; gap:8px;">
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Features</a>
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Pricing</a>
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Integrations</a>
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Changelog</a>
        </div>
      </div>
      <div class="footer-col">
        <h4 style="margin-bottom:16px;">Resources</h4>
        <div style="display:flex; flex-direction:column; gap:8px;">
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Documentation</a>
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">API Reference</a>
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Community</a>
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Blog</a>
        </div>
      </div>
      <div class="footer-col">
        <h4 style="margin-bottom:16px;">Legal</h4>
        <div style="display:flex; flex-direction:column; gap:8px;">
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Privacy Policy</a>
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Terms of Service</a>
          <a href="#" style="color: var(--text-secondary); text-decoration:none;">Security</a>
        </div>
      </div>
    </div>
    <div
      style="text-align:center; padding-top:40px; border-top:1px solid var(--border-light); font-size:13px; color: var(--text-muted);">
      &copy; 2025 DocQuery.ai. All rights reserved.
    </div>
  </footer>

  <!-- Scripts -->
  <script src="{% static 'ragapp/main.js' %}?v=20251217"></script>
  <script>
    // Scroll to top on page load
    window.addEventListener('load', function () {
      window.scrollTo(0, 0);
    });

    // Also scroll to top immediately
    if (history.scrollRestoration) {
      history.scrollRestoration = 'manual';
    }
    window.scrollTo(0, 0);

    // --- Settings Popover Logic ---
    const settingsTrigger = document.getElementById('settingsTrigger');
    const settingsPopover = document.getElementById('settingsPopover');

    if (settingsTrigger && settingsPopover) {
      settingsTrigger.addEventListener('click', (e) => {
        e.stopPropagation();
        settingsPopover.classList.toggle('visible');
      });
    }

    // --- Account Dropdown Logic ---
    const accountTrigger = document.getElementById('accountTrigger');
    const accountDropdown = document.getElementById('accountDropdown');

    if (accountTrigger && accountDropdown) {
      accountTrigger.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        accountDropdown.classList.toggle('visible');
      });
    }

    // --- Global Click Listener (Closes Dropdowns) ---
    document.addEventListener('click', (e) => {
      // Close Settings Popover if clicked outside
      if (settingsPopover && settingsTrigger && !settingsPopover.contains(e.target) && !settingsTrigger.contains(e.target)) {
        settingsPopover.classList.remove('visible');
      }

      // Close Account Dropdown if clicked outside
      if (accountDropdown && accountTrigger && !accountDropdown.contains(e.target) && !accountTrigger.contains(e.target)) {
        accountDropdown.classList.remove('visible');
      }
    });

    // --- Toggle State Logic (for small pills) ---
    function toggleState(btn) {
      btn.classList.toggle('active');
    }

    // --- Search Redirection Logic ---
    // Handled by main.js
    const heroSearchInput = document.getElementById('heroSearchInput');
    const heroSearchSubmit = document.getElementById('heroSearchSubmit');
    // Inline logic removed to prevent conflicts

    // --- Logout Logic ---
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        // Clear Client session
        localStorage.removeItem('current_conversation_id');
        localStorage.removeItem('global_conversation_id');
        Object.keys(localStorage).forEach(key => {
          if (key.startsWith('chat_session_')) {
            localStorage.removeItem(key);
          }
        });
        // Call Server Logout
        await fetch('/api/auth/logout/', { method: 'POST' });
        window.location.href = '/';
      });
    }

  </script>

  <!-- PDF Viewer Overlay (Split View) -->
  <div id="pdfViewerOverlay" class="pdf-viewer-overlay" style="display: none;">
    <div class="pdf-viewer-container split-view">

      <!-- Header -->
      <div class="pdf-viewer-header">
        <div class="pdf-header-left">
          <h3 id="pdfViewerTitle">Document Viewer</h3>
          <span class="trust-badge"
            style="margin-left: 12px; font-size: 0.8rem; background: rgba(var(--accent-primary-rgb), 0.1); color: var(--accent-primary); padding: 4px 8px; border-radius: 4px;">
            <i class="fas fa-lock" style="font-size: 0.7em;"></i> Answers limited to this document
          </span>
          <span id="pdfChatTitle" style="display:none;"></span>
        </div>
        <button class="close-viewer-btn" onclick="app.hidePDFViewer()">
          <i class="fas fa-times"></i> Close
        </button>
      </div>

      <!-- Body: Split Layout -->
      <div class="pdf-viewer-body split-body" style="display: flex; height: 100%; overflow: hidden;">

        <!-- Left: PDF Frame -->
        <div class="pdf-viewer-pane" style="flex: 1; border-right: 1px solid var(--border-light); position: relative;">
          <iframe id="pdfViewerFrame" src="" class="pdf-iframe"
            style="width: 100%; height: 100%; border: none;"></iframe>
        </div>

        <!-- Right: Chat Interface (HIDDEN as per user request for Eye Icon) -->
        <div class="pdf-chat-pane"
          style="width: 450px; display: none; flex-direction: column; background: var(--bg-surface); position: relative;">

          <!-- Chat Messages (Scrollable) -->
          <div id="pdfChatMessages" class="chat-history"
            style="flex: 1; overflow-y: auto; padding: 20px; scroll-behavior: smooth;">
            <!-- Initial State will be injected by JS -->
          </div>

          <!-- Bottom Sticky Input -->
          <div class="pdf-chat-input-area"
            style="padding: 16px; border-top: 1px solid var(--border-light); background: var(--bg-surface); position: relative; z-index: 10;">
            <div class="input-wrapper"
              style="display: flex; align-items: center; gap: 8px; background: var(--bg-input); border: 1px solid var(--border-light); border-radius: 24px; padding: 6px 14px; transition: all 0.2s;">

              <input type="text" id="pdfChatInput" placeholder="Ask a question about this PDF..."
                style="flex: 1; border: none; background: transparent; outline: none; font-size: 0.95rem; color: var(--text-primary); padding: 8px 0;"
                onkeydown="if(event.key === 'Enter') app.sendOverlayMessage()">

              <button id="pdfMicBtn" class="mic-btn" onclick="app.toggleOverlayMic()"
                style="background: transparent; border: none; color: var(--text-secondary); cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                <i class="fas fa-microphone"></i>
              </button>

              <button id="pdfSendBtn" class="send-btn" onclick="app.sendOverlayMessage()"
                style="background: var(--accent-primary); border: none; color: white; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <i class="fas fa-paper-plane" style="font-size: 0.9rem;"></i>
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

</body>

</html>